<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Approvideo Learning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
             margin-bottom: 120px; /* Ensure space for sticky footer */
        }
        /* --- Category Title Display --- */
        #category-title-display {
            transition: opacity 0.4s ease-out, max-height 0.4s ease-out, margin-top 0.4s ease-out, padding 0.4s ease-out;
            overflow: hidden; max-height: 0; opacity: 0; margin-top: 0; padding: 0;
            text-align: center; font-size: 1.5rem; font-weight: 600; letter-spacing: 0.1em; color: #374151; text-transform: uppercase;
        }
        #category-title-display.visible { max-height: 100px; opacity: 1; margin-top: 1rem; padding: 0.5rem 0; }
        /* Column container */
        #megamenu-columns { transition: opacity 0.4s ease-out, max-height 0.5s ease-out; overflow: hidden; max-height: 2000px; opacity: 1; }
        #megamenu-columns.columns-hidden { max-height: 0; opacity: 0; }
        /* Details area */
        #megamenu-details-area {
             transition: opacity 0.4s ease-out 0.1s, max-height 0.4s ease-out, margin-top 0.4s ease-out, padding-top 0.4s ease-out, visibility 0.4s ease-out, border-top-width 0.4s ease-out;
             overflow: hidden; max-height: 0; opacity: 0; margin-top: 0; padding-top: 0; visibility: hidden; border-top-width: 0;
        }
        #megamenu-details-area.visible { max-height: 2500px; /* Increased max-height */ opacity: 1; margin-top: 1.5rem; padding-top: 1.5rem; visibility: visible; border-top-width: 1px; }
        /* Megamenu container */
        #megamenu-content {
             transition: opacity 0.3s ease-out, transform 0.3s ease-out, visibility 0.3s ease-out, margin-top 0.4s ease-out;
             transform-origin: top center; visibility: visible; position: relative; z-index: 10; margin-top: -8px;
        }
        #megamenu-content.hidden { opacity: 0; transform: scaleY(0.95) translateY(-10px); visibility: hidden; pointer-events: none; margin-top: -8px; }
        body.glossary-visible #megamenu-content { margin-top: 0.5rem; }
        /* Glossary Panel */
        #glossary-panel {
             transition: opacity 0.4s ease-out, max-height 0.4s ease-out, padding 0.4s ease-out, margin-bottom 0.4s ease-out, visibility 0.4s ease-out;
             overflow: hidden; max-height: 0; opacity: 0; padding-top: 0; padding-bottom: 0; margin-bottom: 0; visibility: hidden; position: relative; z-index: 20; margin-top: 0.5rem;
        }
        #glossary-panel.visible { max-height: 300px; opacity: 1; padding-top: 1rem; padding-bottom: 1rem; margin-bottom: -0.5rem; visibility: visible; }
        /* Header buttons */
        .header-button { transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out; position: relative; z-index: 30; }
        .header-button:hover { transform: translateY(-2px); }
        .header-button.active .icon-circle { filter: brightness(1.1); }
        .header-button:focus { outline: none; }
        .header-button:focus-visible .icon-circle { box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.6); }
        /* Icon circle */
        .icon-circle {
             width: 48px; height: 48px; border-radius: 9999px; display: flex; align-items: center; justify-content: center; margin-bottom: 0.25rem;
             transition: background 0.2s ease-in-out, box-shadow 0.2s ease-in-out, filter 0.2s ease-in-out; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header-button:hover .icon-circle { box-shadow: 0 4px 8px rgba(0,0,0,0.15); filter: brightness(1.05); }
        /* Gradients */
        .icon-circle-shelter { background-image: linear-gradient(to bottom right, #60a5fa, #4ade80); }
        .icon-circle-water { background-image: linear-gradient(to bottom right, #22d3ee, #3b82f6); }
        .icon-circle-waste { background-image: linear-gradient(to bottom right, #4ade80, #facc15); }
        .icon-circle-energy { background-image: linear-gradient(to bottom right, #facc15, #f97316); }
        .icon-circle-health { background-image: linear-gradient(to bottom right, #f87171, #ec4899); }
        .icon-circle-food { background-image: linear-gradient(to bottom right, #22c55e, #a16207); }
        /* Tag pills */
        .tag-pill-button {
             display: inline-block; background-color: #4b5563; color: white; padding: 3px 10px; border-radius: 9999px; font-size: 0.75rem; font-weight: 500;
             margin-right: 4px; margin-bottom: 4px; line-height: 1.2; cursor: pointer; border: none; transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
        }
        .tag-pill-button:hover { background-color: #374151; transform: translateY(-1px); }
        .tag-pill-button.active { background-color: #1d4ed8; font-weight: 600; }
        /* Subcategory toggle */
        .subcategory-toggle { transition: color 0.2s ease-in-out; }
        .subcategory-toggle.active { font-weight: 600; color: #1d4ed8; }
        /* Glossary Close Button */
        .glossary-close-button {
             position: absolute; top: 0.5rem; right: 0.75rem; background: rgba(255, 255, 255, 0.1); color: #e5e7eb;
             border: none; border-radius: 9999px; width: 1.75rem; height: 1.75rem; display: flex; align-items: center; justify-content: center; cursor: pointer;
             transition: background-color 0.2s ease, color 0.2s ease;
        }
        .glossary-close-button:hover { background: rgba(255, 255, 255, 0.2); color: white; }
        /* Details Back Button */
        .details-back-button {
             display: inline-flex; align-items: center; background-color: #6b7280; color: white; padding: 6px 16px; border-radius: 0.375rem;
             font-size: 0.875rem; font-weight: 500; transition: background-color 0.2s ease-in-out; cursor: pointer; border: none;
        }
        .details-back-button:hover { background-color: #4b5563; }

        /* --- Video Linker Styles (Copied & Integrated) --- */
        .video-linker-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 1.5rem; /* Added margin */
            padding-top: 1rem;
            border-top: 1px dashed #e5e7eb; /* Adjusted color */
        }
        .video-linker {
            display: flex; align-items: center; justify-content: center;
            width: 72px; height: 72px; border-radius: 8px;
            text-decoration: none; color: white; font-size: 30px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 1px 1px 4px rgba(0,0,0,0.15);
            overflow: hidden; cursor: pointer; flex-shrink: 0;
        }
        .video-linker:hover { transform: scale(1.05); box-shadow: 3px 3px 7px rgba(0,0,0,0.25); }
        .video-linker.no-icon {
             font-size: 9px; line-height: 1.1; padding: 5px; text-align: center;
             word-wrap: break-word; color: #333; /* Darker text for fallback */
             background-color: #e5e7eb !important; /* Ensure background for text visibility */
        }

        /* --- Shared Info Panel Styles (Copied & Integrated) --- */
        #video-info-panel {
            display: none; align-items: flex-start;
            padding: 10px 15px; background-color: #343a40; color: #f8f9fa;
            border-top: 3px solid #007bff; box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            min-height: 80px; transition: opacity 0.3s ease; opacity: 0;
            position: fixed; /* Use fixed for reliable stickiness */
            bottom: 0; left: 0; right: 0; z-index: 1000;
        }
        #video-info-panel.visible { display: flex; opacity: 1; }
        #video-info-panel .info-icon {
             font-size: 36px; color: #FF0000; margin-right: 15px;
             flex-shrink: 0; padding-top: 3px;
        }
        #video-info-panel .info-text {
             display: flex; flex-direction: column; gap: 3px;
             overflow: hidden; flex-grow: 1;
        }
        #video-info-panel .info-url,
        #video-info-panel .info-title,
        #video-info-panel .info-description {
             margin: 0; line-height: 1.4; white-space: normal; word-break: break-word;
        }
        #video-info-panel .info-url {
             font-size: 0.75em; color: #adb5bd; font-family: monospace;
             white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        #video-info-panel .info-title { font-size: 1em; font-weight: bold; color: #ffffff; }
        #video-info-panel .info-description {
             font-size: 0.85em; color: #ced4da; max-height: 4.0em; overflow-y: auto;
        }
        #video-info-panel .placeholder-text { font-style: italic; color: #888; }
        
        /* --- Sibling Subcategory Link Styles --- */
        .sibling-links-container {
            margin-bottom: 1.5rem; /* Add space below the pills */
            padding-bottom: 0.75rem; /* Add space above the line */
            border-bottom: 1px solid #e5e7eb; /* Separator line */
            line-height: 1.5; /* Adjust line height for better spacing if pills wrap */
        }
        .sibling-links-container > span { /* Style the 'See also:' text */
            font-size: 0.9rem;
            font-weight: 500;
            color: #6b7280; /* gray-500 */
            margin-right: 8px;
        }
        .sibling-link-pill {
            display: inline-block;
            padding: 4px 12px; /* Adjust padding for size */
            border-radius: 9999px; /* Fully rounded */
            margin: 3px 4px; /* Spacing between pills */
            font-weight: 600; /* Bold */
            color: white;
            background-color: #4f46e5; /* Indigo color - choose your theme color */
            text-decoration: none;
            font-size: 0.8rem; /* Small text */
            transition: background-color 0.2s, transform 0.1s;
            cursor: pointer;
            border: none; /* Ensure it looks like a pill, not a button */
        }
        .sibling-link-pill:hover {
            background-color: #4338ca; /* Darker indigo on hover */
            transform: translateY(-1px);
        }
        /* Style for the currently viewed subcategory's "pill" (optional, can look disabled) */
        .sibling-link-pill.current {
             background-color: #a5b4fc; /* Lighter indigo */
             color: #3730a3; /* Darker text */
             cursor: default;
             pointer-events: none; /* Not clickable */
        }

    </style>
</head>
<body class="bg-gray-100 pt-8 pb-16">
    <div class="max-w-7xl mx-auto px-4">
        <div class="flex items-center justify-between h-16">
            <div class="flex items-center space-x-4">
                 <a href="index.html" class="flex items-center space-x-3 group">
                    <svg id="logoIcon" class="h-10 w-10 text-green-500 group-hover:text-green-600 transition-colors duration-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c.246 0 .492-.015.732-.044m-1.464 0A9.006 9.006 0 0 1 12 3c.587 0 1.159.069 1.711.193M12 3a9.006 9.006 0 0 0-7.08 2.886M12 3c.015-.01.03-.019.046-.028M12 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm4.016 4.016a9.003 9.003 0 0 0 -8.032 0M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z"></path></svg>
                    <span class="text-xl font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">Approvideo Learning Hub</span>
                 </a>
            </div>
            <div class="flex items-center space-x-6">
                <span id="offline-indicator" class="text-xs ml-2 font-semibold text-yellow-600 dark:text-yellow-400"></span>
            </div>
        </div>

        <nav class="relative">
            <div id="button-bar" class="flex flex-wrap justify-center bg-gradient-to-r from-gray-700 via-gray-800 to-gray-900 rounded-lg shadow-md p-3 gap-2 md:gap-4 relative z-30">
                </div>
            <div id="category-title-display">
                </div>
            <div id="glossary-panel" class="w-[95%] md:w-[90%] max-w-4xl mx-auto bg-gray-800 text-gray-100 rounded-lg shadow-xl p-4">
                 <p class="text-center text-gray-400">Click a tag to see its definition.</p>
            </div>
            <div id="megamenu-content" class="w-[95%] md:w-[90%] max-w-4xl mx-auto bg-white rounded-b-lg shadow-xl p-6 pt-10 pb-6">
                <div id="megamenu-columns" class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-8">
                    <div class="text-center text-gray-500 col-span-1 md:col-span-3">Select a category above to see details.</div>
                </div>
                <div id="megamenu-details-area" class="border-gray-200">
                    </div>
            </div>
        </nav>
    </div>

    <div id="video-info-panel">
        <div class="info-icon"><i class="fab fa-youtube"></i></div>
        <div class="info-text">
            <p class="info-url" id="info-url"><span class="placeholder-text">Hover over a video square...</span></p>
            <p class="info-title" id="info-title"></p>
            <p class="info-description" id="info-description"></p>
        </div>
    </div>

    <script>
        // --- Data ---
        const categoryData = [
            {
              "area": "Shelter", "icon": "fa-home",
              "subcategories": [
                { "uniqueId": "shelter-0", "title": "Low-cost, Durable Construction Methods", "description": "Learn how to build safe, long-lasting structures using simple tools and affordable materials. Ideal for creating strong shelters in resource-limited areas.", "tags": ["construction", "low-cost", "durable", "building"], "context": "Context for durable construction: Focuses on resilience against elements and longevity with minimal upkeep.", "materials": ["Earthbags", "Bamboo", "Recycled Tires", "Superadobe"], "processSteps": ["Site Preparation & Foundation", "Wall Construction Techniques", "Roofing Options", "Finishing & Sealing"],
                  "videos": [
                      { "title": "DIY Concrete Block Foundation for Small Structures", "youtubeId": "KDvH1hoEMPQ", "description": "How to build a simple but strong foundation with concrete blocks", "icon_tag_fa": "fas fa-layer-group", "color_tag": "#78716c"},
                      { "title": "Building With Earth - Complete Cob Workshop", "youtubeId": "0olcwSwRELw", "description": "Learn the basics of building with cob...", "icon_tag_fa": "fas fa-house-user", "color_tag": "#a16207"}
                  ]
                },
                { "uniqueId": "shelter-1", "title": "Locally Available Materials", "description": "Find out how to identify and use materials from your immediate surroundings—like earth, bamboo, or recycled materials—to lower costs and support sustainability.", "tags": ["materials", "local", "sustainability", "earthship"], "context": "Why use local materials: Reduces transportation costs and carbon footprint, supports local economy, often culturally appropriate.", "materials": ["Adobe/Cob", "Rammed Earth", "Salvaged Wood", "Stone"], "processSteps": ["Material Identification & Sourcing", "Testing Suitability", "Processing & Preparation", "Integration into Building"],
                  "videos": [ 
                      {"title": "How to Identify and Process Local Clay for Construction", "youtubeId": "eOOYrY4zxpw", "description": "Testing and preparing natural clay for building projects", "icon_tag_fa": "fas fa-paint-roller", "color_tag": "#a16207" },
                      {"title": "Bamboo Harvesting and Treatment for Construction", "youtubeId": "9-Ka4YcyOFo", "description": "How to select, harvest, and treat bamboo for long-lasting building materials", "icon_tag_fa": "fas fa-tree", "color_tag": "#16a34a" },
                      {"title": "Creative Reuse: Building With Glass Bottles", "youtubeId": "M7P8YAIhBkY", "description": "How to incorporate waste glass bottles into walls for beauty and function", "icon_tag_fa": "fas fa-recycle", "color_tag": "#059669" },
                    ]
                 }
              ]
            },
            {
              "area": "Water", "icon": "fa-tint",
              "subcategories": [ /* ... water subcategories ... */

                { "uniqueId": "water-0", "title": "Purification", "description": "Use household items or low-cost filters to make water safe for drinking. Includes simple boiling, sand filtering, and solar disinfection techniques.", "tags": ["clean water", "filtration", "health", "SODIS"], "context": "Importance of clean water: Prevents waterborne diseases like cholera and typhoid, crucial for overall health.", "materials": ["Sand", "Gravel", "Activated Charcoal", "Clear PET Bottle", "Cloth"], "processSteps": ["Boiling Procedure", "Building a BioSand Filter", "Solar Water Disinfection (SODIS)", "Chlorination (if applicable)"],
                    "videos": [ 
                      {"icon_tag_fa": "fas fa-paint-roller", "color_tag": "#a16207", "title": "WAter purification with improvised materials", "youtubeId": "eOOYrY4zxpw", "description": "Testing and preparing natural clay for building projects"},
                      {"icon_tag_fa": "fas fa-tree", "color_tag": "#16a34a", "title": "water acquasition ", "youtubeId": "9-Ka4YcyOFo", "description": "How to select, harvest, and treat bamboo for long-lasting building materials"},
                      {"icon_tag_fa": "fas fa-recycle", "color_tag": "#059669", "title": "water evaporative capture and dew dew and fog", "youtubeId": "M7P8YAIhBkY", "description": "How to incorporate waste glass bottles into walls for beauty and function"},
                    ]
                 },
                { "uniqueId": "water-1", "title": "Desalination", "description": "Build small-scale systems to turn salty or brackish water into fresh water using heat and condensation. Great for coastal or saline-prone areas.", "tags": ["salt removal", "ocean", "irrigation", "solar still"], "context": "Addressing water scarcity: Provides freshwater source where others are unavailable, vital for coastal/arid regions.", "materials": ["Black plastic sheeting", "Clear plastic/glass cover", "Collection container", "Tubing/Gutter"], "processSteps": ["Constructing a Basic Solar Still", "Optimizing Condensation", "Collection & Storage", "Maintenance"],
                    "videos": [ 
                      {"icon_tag_fa": "fas fa-paint-roller", "color_tag": "#a16207", "title": "Water purification with improvised materials", "youtubeId": "eOOYrY4zxpw", "description": "Testing and preparing natural clay for building projects"},
                      {"icon_tag_fa": "fas fa-tree", "color_tag": "#16a34a", "title": "water acquasition ", "youtubeId": "9-Ka4YcyOFo", "description": "How to select, harvest, and treat bamboo for long-lasting building materials"},
                      {"icon_tag_fa": "fas fa-recycle", "color_tag": "#059669", "title": "water evaporative capture and dew dew and fog", "youtubeId": "M7P8YAIhBkY", "description": "How to incorporate waste glass bottles into walls for beauty and function"},
                    ]

                 },
                { "uniqueId": "water-2", "title": "Efficient Distribution", "description": "Design and improve gravity-fed or pump-based systems to distribute water evenly and reduce waste. Tips include pipe layout, storage tanks, and elevation tricks.", "tags": ["pipes", "delivery", "infrastructure", "gravity feed"], "context": "Reducing water loss: Ensures equitable access, conserves precious resource, minimizes energy for pumping.", "materials": ["PVC/HDPE pipes", "Storage tanks (ferrocement, plastic)", "Valves & Taps", "Pump (if needed)"], "processSteps": ["Topographical Survey & Planning", "Pipe Laying & Joining", "Tank Installation & Connection", "Leak Detection & Repair"] ,
                    "videos": [ 
                      {"icon_tag_fa": "fas fa-paint-roller", "color_tag": "#a16207", "title": "Water purification with improvised materials", "youtubeId": "eOOYrY4zxpw", "description": "Testing and preparing natural clay for building projects"},
                      {"icon_tag_fa": "fas fa-tree", "color_tag": "#16a34a", "title": "water acquasition ", "youtubeId": "9-Ka4YcyOFo", "description": "How to select, harvest, and treat bamboo for long-lasting building materials"},
                      {"icon_tag_fa": "fas fa-recycle", "color_tag": "#059669", "title": "water evaporative capture and dew dew and fog", "youtubeId": "M7P8YAIhBkY", "description": "How to incorporate waste glass bottles into walls for beauty and function"},
                    ]    
                }

               ]
            },
            {
              "area": "Waste", "icon": "fa-recycle",
              "subcategories": [
                { "uniqueId": "waste-0", "title": "Composting", "description": "Learn how to convert organic waste into nutrient-rich soil. Includes techniques for both urban and rural settings, managing compost temperature, and using the final product.", "tags": ["composting", "organic waste", "soil improvement", "sustainability"], "context": "Recycling nutrients...", "materials": ["Organic waste", "Browns (carbon)", "Greens (nitrogen)"], "processSteps": ["Build bin", "Layer materials", "Turn pile"] },
                { "uniqueId": "waste-1", "title": "Recycling Systems", "description": "Set up community or household recycling systems to properly sort and process recyclable materials. Covers plastic, paper, glass, and metal recycling basics.", "tags": ["recycling", "waste sorting", "materials recovery"], "context": "Managing solid waste...", "materials": ["Sorting bins", "Collection bags"], "processSteps": ["Sort materials", "Clean recyclables", "Arrange collection"] },
                { "uniqueId": "waste-2", "title": "Upcycling", "description": "Transform discarded items into useful products. Learn creative approaches to reuse materials that would otherwise become waste.", "tags": ["upcycling", "creative reuse", "waste reduction"], "context": "Adding value to waste...", "materials": ["Plastic bottles", "Old tires", "Textiles"], "processSteps": ["Collect materials", "Design product", "Create"] },
                { "uniqueId": "waste-3", "title": "Wastewater Management", "description": "Build simple systems to treat and safely dispose of greywater and blackwater. Includes constructed wetlands, filtration beds, and safe handling practices.", "tags": ["wastewater", "greywater", "sanitation", "treatment"], "context": "Safe sanitation...", "materials": ["Gravel", "Sand", "Plants", "Pipes"], "processSteps": ["Site selection", "Excavation", "Layering filter media"] }
              ]
            },
            {
              "area": "Energy", "icon": "fa-solar-panel",
              "subcategories": [
                { "uniqueId": "energy-0", "title": "Solar Box Cookers", "description": "effective basic box cooker design of three types parabola,  box reflective enclosure with dark pot, and inculated glass cover reflector oven cookers", "tags": ["solar cooker", "DIY", "power", "off-grid"], "context": "Harnessing solar power...", "materials": ["Solar panel", "Charge controller", "Battery", "Wiring"], "processSteps": ["Mount panel", "Connect components", "Test system"] },
                { "uniqueId": "energy-1", "title": "Biogas Generation", "description": "Turn kitchen and animal waste into clean-burning gas for cooking. Learn how to build a small digester, maintain it, and safely use the gas.", "tags": ["biogas", "waste", "energy", "renewable"], "context": "Waste to energy...", "materials": ["Drum/Tank", "Pipes", "Manure/Waste"], "processSteps": ["Build digester", "Feed slurry", "Collect gas"] },
                { "uniqueId": "energy-2", "title": "Microgrids for Sustainable Power", "description": "Build small, local power systems that connect solar, wind, or battery energy to homes and clinics. Learn how to balance loads and increase energy access.", "tags": ["microgrid", "sustainability", "infrastructure"], "context": "Community power...", "materials": ["Generation sources", "Batteries", "Inverters", "Grid controller"], "processSteps": ["Assess needs", "Design system", "Install & commission"] },
                { "uniqueId": "energy-3", "title": "Hand Pressed Heat & Cooking Fuel Briquettes", "description": "DIY cook stove Fuel produced from waste combustible biomass slurry", "tags": ["cooking fuel", "upcycling", "home heating", "biomass"], "context": "Alternative cooking fuel...", "materials": ["Biomass waste", "Binder", "Press"], "processSteps": ["Prepare slurry", "Press briquettes", "Dry briquettes"] }
              ]
            },
            {
              "area": "Health", "icon": "fa-heartbeat",
              "subcategories": [
                { "uniqueId": "health-0", "title": "EMT Skills", "description": "Learn lifesaving basics such as CPR, wound dressing, splinting, and how to assess an emergency before help arrives.", "tags": ["EMT", "emergency", "first response", "CPR"], "context": "Basic life support...", "materials": ["First aid kit", "Training mannequin (optional)"], "processSteps": ["Scene safety", "Patient assessment", "Interventions (CPR, bleeding control)"] },
                { "uniqueId": "health-1", "title": "Telemedicine", "description": "Use phones and simple apps to connect with doctors remotely. Learn how to explain symptoms, send photos, and follow up with online care.", "tags": ["health", "telemedicine", "remote care", "digital health"], "context": "Accessing remote healthcare...", "materials": ["Smartphone/Computer", "Internet access"], "processSteps": ["Find provider", "Schedule appointment", "Consultation"] },
                { "uniqueId": "health-2", "title": "First Aid", "description": "Master everyday skills for cuts, burns, insect bites, and fevers. Helps reduce complications when access to a clinic is delayed.", "tags": ["first aid", "injury", "emergency", "home care"], "context": "Treating common injuries...", "materials": ["Bandages", "Antiseptic wipes", "Gauze", "Tape"], "processSteps": ["Assess injury", "Clean wound", "Dress wound"] },
                { "uniqueId": "health-3", "title": "Self-sufficient Healthcare", "description": "Set up a basic first aid station at home or in your village. Includes herbal remedies, rehydration recipes, and supply checklists.", "tags": ["health", "DIY", "self-reliance", "herbal medicine"], "context": "Community health resilience...", "materials": ["Basic medical supplies", "Local herbs", "Clean containers"], "processSteps": ["Identify needs", "Stock supplies", "Learn basic remedies"] }
              ]
            },
            {
              "area": "Food", "icon": "fa-utensils",
              "subcategories": [
               { "uniqueId": "food-0", "title": "Urban Gardening", "description": "Grow healthy vegetables in small spaces using buckets, rooftops, or window boxes. Learn how to compost and plant in cycles.", "tags": ["urban farming", "gardening", "food security", "container gardening"], "context": "Growing food in cities...", "materials": ["Containers", "Soil/Compost", "Seeds/Seedlings"], "processSteps": ["Prepare containers", "Planting", "Watering & care"],
                  "videos": [
                        { "title": "Organic/Biodynamic Farming in the City", "youtubeId": "QJcACw_--Nk", "description": "Explores the realities of urban farming in Portland...", "icon_tag_fa": "fas fa-city", "color_tag": "#6B7280" },
                        { "title": "Community Gardens as health and vitality nodes", "youtubeId": "QZQpIHIr7s0", "description": "Growing Together: How community gardens are important for your mental health", "icon_tag_fa": "fas fa-sprout", "color_tag": "#6B7280" },
                        { "title": "Community Gardens address food deserts", "youtubeId": "QZQpIHIr7s0", "description": "Growing Together: How community gardens are important for your mental health", "icon_tag_fa": "fas fa-sprout", "color_tag": "#6B7280" }
                ]
               },  
               },
                { "uniqueId": "food-1", "title": "Soil-less farming", "description": "Use water-based growing systems to raise food without soil. Learn to mix nutrient solutions and maintain pH for healthy crops.", "tags": ["hydroponics", "water-efficient", "urban food", "aquaponics"], "context": "Soilless agriculture...", "materials": ["System components (pipes, pump)", "Nutrient solution", "Growing medium (optional)"], "processSteps": ["Assemble system", "Mix nutrients", "Monitor pH/EC"], 
                "videos": [
                        { "title": "Feed the World – Aquaponics", "youtubeId": "ofS9MFXFIBE", "description": "Introduces aquaponics as a sustainable food...", "icon_tag_fa": "fas fa-fish", "color_tag": "#3B82F6" },
                        { "title": "Aquaponics Simplified: A Guide...", "youtubeId": "4DMylpQqVKI", "description": "Features 'Aqua Annie' demonstrating a small-scale...", "icon_tag_fa": "fas fa-seedling", "color_tag": "#10B981" },
                        { "title": "Designing a Sustainable Aquaponics System: An Inventor’s Touch", "youtubeId": "x6buXYuvXWg", "description": "Showcases inventor Curt Yungwirth's innovations...", "icon_tag_fa": "fas fa-cogs", "color_tag": "#57534e" },
                        { "title": "Why Organic, Sustainable Farming Matters...", "youtubeId": "mD5jnxhne7o", "description": "Presents farmer Jesse Straight's perspective...", "icon_tag_fa": "fas fa-tractor", "color_tag": "#ca8a04" },
                        { "title": "Germany's Bug Burgers", "youtubeId": "5eibeYxRt5w", "description": "Explores insect consumption via 'Bug Burgers'...", "icon_tag_fa": "fas fa-bug", "color_tag": "#7c2d12" },
                        { "title": "Is Microalgae the Sustainable Food of the Future?", "youtubeId": "VFNS7Is6Td0", "description": "Investigates microalgae as a potential future food source...", "icon_tag_fa": "fas fa-bacteria", "color_tag": "#0d9488" },
                        { "title": "Mushroom Farming Basics", "youtubeId": "9IFTMnftLgU", "description": "Growing edible mushrooms on straw and other byproducts", "icon_tag_fa": "fas fa-cloud", "color_tag": "#a1a1aa" },
                        { "title": "Spirulina Micro-Farming at Home", "youtubeId": "SMUf_pbxkcU", "description": "Small-scale production of this nutrient-dense blue-green algae", "icon_tag_fa": "fas fa-vial", "color_tag": "#2dd4bf" },
                        { "title": "Insect Farming: Cricket Rearing Systems", "youtubeId": "jp6OgNyTxA0", "description": "Setting up efficient cricket production for protein", "icon_tag_fa": "fas fa-crow", "color_tag": "#3f3f46" },
                        { "title": "Black Soldier Fly Larvae Composting", "youtubeId": "5j0YCyg0vpE", "description": "Converting organic waste to animal feed using insect larvae", "icon_tag_fa": "fas fa-recycle", "color_tag": "#166534" },
                        { "title": "Ancient Grain Recovery and Cultivation", "youtubeId": "Xqn490UuVQU", "description": "Growing forgotten but nutritious grain varieties", "icon_tag_fa": "fas fa-wheat-awn", "color_tag": "#f59e0b" },
                        { "title": "Simple Automation for Small-Scale Agriculture", "youtubeId": "eHMpkXiGEag", "description": "Low-tech solutions to reduce manual labor in food production", "icon_tag_fa": "fas fa-robot", "color_tag": "#78716c" }
                    ]
                },
                { "uniqueId": "food-2", "title": "Sustainable Agriculture Techniques", "description": "Practice crop rotation, natural pest control, and cover cropping to improve soil health and increase yields without chemicals.", "tags": ["agriculture", "sustainable", "soil health", "permaculture"], "context": "Eco-friendly farming...", "materials": ["Compost", "Cover crop seeds", "Natural pest deterrents"], "processSteps": ["Plan rotation", "Plant cover crops", "Integrated pest management"] },
                    "videos": [
                        {"title": "Pulse Crop Rotation benefits other crops.", "youtubeId": "QJcACw_--Nk", "description": "Pulse crop rotation is highly beneficial, particularly for soil health, nutrient cycling, and overall crop productivity. Pulses, like peas and beans, help improve soil fertility by fixing atmospheric nitrogen and reducing the need for synthetic fertilizers.", "icon_tag_fa": "fas fa-city", "color_tag": "#6B7280" },
                        {"title": "Natural Pest Control Methods for Gardens", "youtubeId": "VIDEO_ID_PLACEHOLDER", "description": "Using companion planting, beneficial insects, and natural sprays.", "icon_tag_fa": "fas fa-shield-alt", "color_tag": "#dc2626" },
                        {"icon_tag_fa": "fas fa-leaf", "color_tag": "#16a34a", "title": "Cover Cropping for Beginners: Building Soil", "youtubeId": "NbvDEAomVlk?t=175", "description": "putting weeds into action section of her talk."},
                        {"title": " How to Start a No-Till Garden from Scratch ", "youtubeId": "sdmqbhQo-yw", "description": "how to start a garden from scratch, how to start a raised bed garden, how to start a no-till garden, gardening without raised beds, farming for beginners, gardening for beginners, ", "icon_tag_fa": "fas fa-tractor", "color_tag": "#78350f"},
                        {"icon_tag_fa": "fas fa-tractor", "color_tag": "#78350f", "title": "Introduction to No-Till Farming Techniques", "youtubeId": "0xvp8sWY6Fk", "description": "Minimizing soil disturbance for better structure and water retention."},
                        {"icon_tag_fa": "fas fa-seedling", "color_tag": "#fbbf24", "title": "Seed Saving Basics for Common Vegetables", "youtubeId": "VIDEO_ID_PLACEHOLDER", "description": "How to collect, process, and store seeds from your garden."}
                                 ]
                },  
                { "uniqueId": "food-3", "title": "Fungi, Algae, Insects, & Tech", "description": "Inventory and evaluation of modern and antiquity based food production", "tags": ["alternative protein", "future food", "mycology", "entomophagy"], "context": "Exploring new food sources...", "materials": ["Mushroom spawn", "Insect larvae", "Algae cultures"], "processSteps": ["Cultivation setup", "Harvesting", "Processing"],
                    "videos": [
                        { "title": "Fungi", "youtubeId": "QJcACw_--Nk", "description": "Explores the realities of urban farming in Portland...", "icon_tag_fa": "fas fa-city", "color_tag": "#6B7280" },
                        { "title": "Fungi as Edible Mycelium", "youtubeId": "ofS9MFXFIBE", "description": "Mycelial cake can be dried and grown on various subtrates used as a healthy sustainable food, useful in food resiliency, good converter & detoxifier of materials...", "icon_tag_fa": "fas fa-fish", "color_tag": "#3B82F6" },
                        { "title": "Fungi in soil and ecosystem health", "": "4DMylpQqVKI", "description": "Features 'Aqua Annie' demonstrating a small-scale...", "icon_tag_fa": "fas fa-seedling", "color_tag": "#10B981" },
                        { "title": "Fungi for creating structural compoments", "youtubeId": "x6buXYuvXWg", "description": "Showcases inventor Curt Yungwirth's innovations...", "icon_tag_fa": "fas fa-cogs", "color_tag": "#57534e" },
                        { "title": "Fungi Algae", "youtubeId": "mD5jnxhne7o", "description": "Presents farmer Jesse Straight's perspective...", "icon_tag_fa": "fas fa-tractor", "color_tag": "#ca8a04" },
                        { "title": "Fungi eating insects so people can eat it", "youtubeId": "5eibeYxRt5w", "description": "Explores insect consumption via 'Bug Burgers'...", "icon_tag_fa": "fas fa-bug", "color_tag": "#7c2d12" },
                        { "title": "Is Microalgae the Sustainable Food of the Future?", "youtubeId": "VFNS7Is6Td0", "description": "Investigates microalgae as a potential future food source...", "icon_tag_fa": "fas fa-bacteria", "color_tag": "#0d9488" },
                        { "title": "Mushroom Farming Basics", "youtubeId": "9IFTMnftLgU", "description": "Growing edible mushrooms on straw and other byproducts", "icon_tag_fa": "fas fa-cloud", "color_tag": "#a1a1aa" },
                        { "title": "Spirulina Micro-Farming at Home", "youtubeId": "SMUf_pbxkcU", "description": "Small-scale production of this nutrient-dense blue-green algae", "icon_tag_fa": "fas fa-vial", "color_tag": "#2dd4bf" },
                        { "title": "Insect Farming: Cricket Rearing Systems", "youtubeId": "jp6OgNyTxA0", "description": "Setting up efficient cricket production for protein", "icon_tag_fa": "fas fa-crow", "color_tag": "#3f3f46" },
                        { "title": "Black Soldier Fly Larvae Composting", "youtubeId": "5j0YCyg0vpE", "description": "Converting organic waste to animal feed using insect larvae", "icon_tag_fa": "fas fa-recycle", "color_tag": "#166534" },
                        { "title": "Ancient Grain Recovery and Cultivation", "youtubeId": "Xqn490UuVQU", "description": "Growing forgotten but nutritious grain varieties", "icon_tag_fa": "fas fa-wheat-awn", "color_tag": "#f59e0b" },
                        { "title": "Simple Automation for Small-Scale Agriculture", "youtubeId": "eHMpkXiGEag", "description": "Low-tech solutions to reduce manual labor in food production", "icon_tag_fa": "fas fa-robot", "color_tag": "#78716c" }
                    ]
                }
              ]
            }
        ];

        // Ensure you have the full tagGlossary data here
        const tagGlossary = {
            
            // Shelter Tags
                "construction": "The process or art of building structures.",
                "low-cost": "Achievable with minimal financial resources.",
                "durable": "Able to withstand wear, pressure, or damage; long-lasting.",
                "building": "A structure with walls and a roof, such as a house or factory.",
                "materials": "The matter from which a thing is or can be made.",
                "local": "Relating or restricted to a particular area or neighbourhood.",
                "sustainability": "Meeting the needs of the present without compromising the ability of future generations to meet their own needs, often focusing on environmental balance.",
                "earthship": "A type of passive solar house made of natural and recycled materials, pioneered by architect Michael Reynolds.",

            // Water Tags
                "clean water": "Water that is safe for drinking (potable) and other domestic uses, free from harmful contaminants.",
                "filtration": "The process of removing solid particles from a liquid or gas using a filter medium.",
                "health": "The state of being free from illness or injury; relates to practices promoting well-being.",
                "sodis": "Solar Water Disinfection: A simple method using sunlight and plastic bottles to kill harmful microbes in water.",
                "salt removal": "See 'Desalination'.",
                "ocean": "A very large expanse of sea, specifically each of the main areas into which the sea is divided geographically.",
                "irrigation": "The supply of water to land or crops to help growth, typically by means of channels.",
                "solar still": "A device that uses solar energy to evaporate water and condense the vapor to produce purified (often desalinated) water.",
                "pipes": "Tubes used to convey water, gas, oil, or other fluid substances.",
                "delivery": "The action of transporting something to a destination.",
                "infrastructure": "The basic physical and organizational structures and facilities (e.g., buildings, roads, power supplies) needed for the operation of a society or enterprise.",
                "gravity feed": "A system where a liquid flows from one point to another solely due to the force of gravity, typically from a higher point to a lower one without pumping.",

             // Waste Tags
               "composting": "The process of decomposing organic matter (like food scraps and yard waste) into a nutrient-rich soil amendment called compost.",
                "organic waste": "Biodegradable waste derived from plant or animal sources.",
                "soil improvement": "Enhancing the physical properties, fertility, and health of soil.",
                "recycling": "The process of converting waste materials into new materials and objects.",
                "waste sorting": "Separating different types of waste materials for proper disposal, recycling, or composting.",
                "materials recovery": "Extracting usable materials from waste streams.",
                "upcycling": "Reusing discarded objects or materials in such a way as to create a product of higher quality or value than the original.",
                "creative reuse": "Using discarded items or materials in new, often artistic or functional, ways.",
                "waste reduction": "Minimizing the amount of waste produced.",
                "wastewater": "Water that has been used and contains dissolved or suspended waste matter (includes greywater and blackwater).",
                "greywater": "Relatively clean wastewater from baths, sinks, washing machines, and other kitchen appliances (excluding toilets).",
                "sanitation": "Conditions relating to public health, especially the provision of clean drinking water and adequate sewage disposal.",
                "treatment": "Applying a process to waste or wastewater to make it less harmful or suitable for reuse.",


            // Energy Tags
                "solar cooker": "A device which uses the energy of direct sunlight to heat, cook or pasteurize food or drink.",
                "diy": "Do It Yourself: Building, modifying, or repairing things without the direct aid of experts or professionals.",
                "power": "Electrical energy supplied to operate devices.",
                "off-grid": "Not connected to or served by publicly or privately managed utilities like the electrical grid.",
                "biogas": "Gaseous fuel, especially methane, produced by the fermentation of organic matter.",
                "waste": "Material that is discarded as no longer useful or required; can sometimes be used as a resource (e.g., for biogas).",
                "energy": "Power derived from the utilization of physical or chemical resources, especially to provide light and heat or to work machines.",
                "renewable": "Energy from a source that is not depleted when used, such as wind or solar power.",
                "microgrid": "A small, localized energy grid with its own power generation resources, which can operate independently or connect to a larger grid.",
                "cooking fuel": "Material burned to produce heat for cooking.",
                "home heating": "Systems or fuels used to warm the interior of a home.",
                "biomass": "Organic matter used as a fuel, especially in a power station for the generation of electricity or heat.",

            // Health Tags
                "emt": "Emergency Medical Technician: A trained healthcare provider who responds to emergency calls, performs medical services, and transports patients.",
                "emergency": "A serious, unexpected, and often dangerous situation requiring immediate action.",
                "first response": "The initial assistance or care given to someone who is injured or suddenly becomes ill.",
                "cpr": "Cardiopulmonary Resuscitation: An emergency lifesaving procedure performed when the heart stops beating.",
                "telemedicine": "The remote diagnosis and treatment of patients by means of telecommunications technology.",
                "remote care": "Healthcare services provided to patients who are not physically present with the provider.",
                "digital health": "The use of digital technologies for health and wellness objectives.",
                "first aid": "Help given to a sick or injured person until full medical treatment is available.",
                "injury": "Physical harm or damage to someone's body.",
                "home care": "Care provided in a person's own home, often for minor illnesses or chronic conditions.",
                "self-reliance": "Reliance on one's own powers and resources rather than those of others.",
                "herbal medicine": "The use of plants or plant extracts for medicinal purposes.",

            // Food Tags
                "urban farming": "The practice of cultivating, processing, and distributing food in or around urban areas.",
                "gardening": "The activity of tending and cultivating a garden.",
                "food security": "The state of having reliable access to a sufficient quantity of affordable, nutritious food.",
                "container gardening": "Growing plants exclusively in containers instead of planting them in the ground.",
                "hydroponics": "The process of growing plants in sand, gravel, or liquid, with added nutrients but without soil.",
                "water-efficient": "Using water sparingly or effectively to minimize waste.",
                "urban food": "Food produced or consumed within urban areas.",
                "aquaponics": "A system that combines conventional aquaculture (raising aquatic animals) with hydroponics (cultivating plants in water) in a symbiotic environment.",
                "agriculture": "The science or practice of farming, including cultivation of the soil for the growing of crops and the rearing of animals to provide food, wool, and other products.",
 
            // "sustainable" already defined
                "soil health": "The continued capacity of soil to function as a vital living ecosystem that sustains plants, animals, and humans.",
                "permaculture": "The development of agricultural ecosystems intended to be sustainable and self-sufficient, often drawing inspiration from natural ecosystems.",
                "alternative protein": "Sources of protein outside of traditional animal agriculture, such as plant-based meats, insects, or lab-grown meat.",
                "future food": "Novel or alternative food sources and technologies being explored to meet future global food demands sustainably.",
                "mycology": "The scientific study of fungi.",
                "entomophagy": "The practice of eating insects."
                        
        };

        // --- Global Variables & DOM Elements ---
        const buttonBar = document.getElementById('button-bar');
        const categoryTitleDisplay = document.getElementById('category-title-display');
        const glossaryPanel = document.getElementById('glossary-panel');
        const megamenuContent = document.getElementById('megamenu-content');
        const megamenuColumnsContainer = document.getElementById('megamenu-columns');
        const megamenuDetailsArea = document.getElementById('megamenu-details-area');
        const bodyElement = document.body;
        // Video Panel Elements
        const videoInfoPanel = document.getElementById('video-info-panel');
        const infoUrlEl = document.getElementById('info-url');
        const infoTitleEl = document.getElementById('info-title');
        const infoDescriptionEl = document.getElementById('info-description');
        const placeholderText = '<span class="placeholder-text">Hover over a video square...</span>';

        let currentlyOpenTrigger = null;
        let activeSubcategoryToggle = null;
        let activeGlossaryTrigger = null;
        let allVideosFlat = []; // For flattened video data

        // --- Video Panel Functions ---
        function flattenVideoData(originalData) {
            let flatIndex = 0;
            allVideosFlat = []; // Reset
            originalData.forEach(area => {
                area.subcategories.forEach((subcat) => {
                    // Make sure videos array exists and is an array
                    if (subcat.videos && Array.isArray(subcat.videos)) {
                        subcat.videos.forEach((video) => {
                            if (video && video.youtubeId) { // Basic validation
                                video.icon_tag_fa = video.icon_tag_fa || 'fas fa-video';
                                video.color_tag = video.color_tag || '#6c757d';
                                video.flat_index = flatIndex++;
                                allVideosFlat.push(video);
                            } else {
                                 console.warn(`Skipping invalid video entry in subcategory: ${subcat.title}`, video);
                            }
                        });
                    }
                });
            });
             console.log(`Flattened ${allVideosFlat.length} videos.`);
        }

        function showInfoPanel(video) {
            if (!video || !video.youtubeId) return;
            // Use a standard YouTube watch URL
            const youtubeWatchUrl = `https://www.youtube.com/watch?v=${video.youtubeId}`;
            infoUrlEl.textContent = youtubeWatchUrl;
            infoUrlEl.classList.remove('placeholder-text');
            infoTitleEl.textContent = video.title || 'No Title';
            infoDescriptionEl.textContent = video.description || 'No Description';
            videoInfoPanel.classList.add('visible');
        }

        function hideInfoPanel() {
            infoUrlEl.innerHTML = placeholderText;
            infoTitleEl.textContent = '';
            infoDescriptionEl.textContent = '';
            videoInfoPanel.classList.remove('visible');
        }


        // --- Existing Functions (Generate Buttons, Populate Columns, Glossary, Hide Details etc.) ---
         function generateHeaderButtons() { /* ... (no changes) ... */
             buttonBar.innerHTML = '';
            categoryData.forEach(category => {
                const button = document.createElement('button');
                button.className = 'megamenu-trigger header-button flex flex-col items-center text-white p-2 rounded-md focus:outline-none w-20';
                button.setAttribute('data-area', category.area.toLowerCase());
                button.setAttribute('data-display-name', category.area);
                const circleDiv = document.createElement('div');
                circleDiv.className = `icon-circle icon-circle-${category.area.toLowerCase()}`;
                const icon = document.createElement('i');
                icon.className = `fas ${category.icon} fa-lg text-white`;
                const textSpan = document.createElement('span');
                textSpan.className = 'text-xs font-medium mt-1 text-center';
                textSpan.textContent = category.area;
                circleDiv.appendChild(icon);
                button.appendChild(circleDiv);
                button.appendChild(textSpan);
                buttonBar.appendChild(button);
                button.addEventListener('click', handleMegamenuToggle);
            });
        }
        function populateMegamenuColumns(area) { /* ... (no changes) ... */
             const category = categoryData.find(cat => cat.area.toLowerCase() === area);
            if (!category) {
                megamenuColumnsContainer.innerHTML = '<div class="text-center text-gray-500 col-span-1 md:col-span-3">Category data not found.</div>';
                return;
            }
            megamenuColumnsContainer.innerHTML = '';
            megamenuColumnsContainer.classList.remove('columns-hidden');
            hideSubcategoryDetails(false); // Close details when showing columns
            const columns = [[], [], []];
            category.subcategories.forEach((subcat, index) => {
                 subcat.uniqueId = subcat.uniqueId || `${area}-${index}`; // Ensure uniqueId exists
                 columns[index % 3].push(subcat);
            });
            columns.forEach((columnSubcats) => {
                const columnDiv = document.createElement('div');
                columnDiv.className = 'space-y-6';
                if (columnSubcats.length > 0) {
                    columnSubcats.forEach((subcat) => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'subcategory-item';
                        let tagsHtml = '';
                        if (subcat.tags && subcat.tags.length > 0) {
                            tagsHtml = '<div class="mt-2 flex flex-wrap gap-1">' +
                                subcat.tags.map(tag =>
                                    `<button class="tag-pill-button glossary-trigger" data-tag="${tag.toLowerCase()}">${tag}</button>`
                                ).join('') + '</div>';
                        }
                        itemDiv.innerHTML = `
                            <h4 class="text-md font-semibold text-gray-800 mb-1">${subcat.title}</h4>
                            <p class="text-sm text-gray-600">${subcat.description}</p>
                            ${tagsHtml}
                            <button class="subcategory-toggle text-sm text-blue-600 hover:text-blue-800 hover:underline mt-3" data-area="${area}" data-uniqueid="${subcat.uniqueId}">
                                Show More Info
                            </button>`;
                        columnDiv.appendChild(itemDiv);
                    });
                }
                megamenuColumnsContainer.appendChild(columnDiv);
            });
        }
        function displayGlossaryEntry(tag) { /* ... (no changes) ... */
            const definition = tagGlossary[tag] || "Definition not found for this tag.";
            const term = tag.charAt(0).toUpperCase() + tag.slice(1);
            glossaryPanel.innerHTML = `
                <button class="glossary-close-button" aria-label="Close glossary">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <h4 class="font-semibold text-lg text-white mb-1 pr-8">${term}</h4>
                <p class="text-sm text-gray-300">${definition}</p>
            `;
            glossaryPanel.querySelector('.glossary-close-button').addEventListener('click', hideGlossaryPanel);
            glossaryPanel.classList.add('visible');
            bodyElement.classList.add('glossary-visible');
        }
        function hideGlossaryPanel() { /* ... (no changes) ... */
            glossaryPanel.classList.remove('visible');
            bodyElement.classList.remove('glossary-visible');
            if (activeGlossaryTrigger) {
                activeGlossaryTrigger.classList.remove('active');
                activeGlossaryTrigger = null;
            }
            setTimeout(() => {
                if (!glossaryPanel.classList.contains('visible')) {
                     glossaryPanel.innerHTML = '<p class="text-center text-gray-400">Click a tag to see its definition.</p>';
                }
            }, 400);
        }
        function handleGlossaryTriggerClick(event) { /* ... (no changes) ... */
             event.stopPropagation();
            const currentButton = event.target;
            const tag = currentButton.dataset.tag;
            if (activeGlossaryTrigger === currentButton) {
                hideGlossaryPanel();
            } else {
                if (activeGlossaryTrigger) {
                    activeGlossaryTrigger.classList.remove('active');
                }
                displayGlossaryEntry(tag);
                currentButton.classList.add('active');
                activeGlossaryTrigger = currentButton;
            }
        }
        function hideSubcategoryDetails(updateHash = true) { /* ... (no changes, but maybe hide video panel too?) ... */
            const detailsWereVisible = megamenuDetailsArea.classList.contains('visible');
             megamenuDetailsArea.classList.remove('visible');
             megamenuColumnsContainer.classList.remove('columns-hidden');
            if (activeSubcategoryToggle) {
                activeSubcategoryToggle.classList.remove('active');
                activeSubcategoryToggle.textContent = 'Show More Info';
                activeSubcategoryToggle = null;
            }
             if (detailsWereVisible && updateHash && currentlyOpenTrigger) {
                 const area = currentlyOpenTrigger.dataset.area;
                 window.location.hash = area; // Reset hash to main category
             }
            // Optionally hide video panel when details are hidden
            hideInfoPanel();
            setTimeout(() => {
                 if (!megamenuDetailsArea.classList.contains('visible')) {
                     megamenuDetailsArea.innerHTML = ''; // Clear content after transition
                 }
            }, 400);
        }
         function handleSubcategoryToggle(event) { /* ... (no changes) ... */
              event.stopPropagation();
            const currentButton = event.target;
            const area = currentButton.dataset.area;
            const uniqueId = currentButton.dataset.uniqueid;
            if (activeSubcategoryToggle === currentButton) {
                hideSubcategoryDetails(true);
            } else {
                if (activeSubcategoryToggle) {
                     // If switching directly, briefly show columns to avoid visual jump
                     megamenuColumnsContainer.classList.remove('columns-hidden');
                    activeSubcategoryToggle.classList.remove('active');
                    activeSubcategoryToggle.textContent = 'Show More Info';
                }
                displaySubcategoryDetails(area, uniqueId, true); // This now includes video linkers
                currentButton.classList.add('active');
                currentButton.textContent = 'Hide Info';
                activeSubcategoryToggle = currentButton;
                // Scroll into view smoothly after content is likely rendered
                if (!bodyElement.classList.contains('glossary-visible')) {
                   requestAnimationFrame(() => {
                        setTimeout(() => {
                             megamenuDetailsArea.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Scroll to start of details
                        }, 50); // Small delay
                   });
                }
            }
         }
        function showCategoryTitle(trigger) { /* ... (no changes) ... */
            const displayName = trigger.dataset.displayName || trigger.dataset.area;
            categoryTitleDisplay.textContent = displayName;
            categoryTitleDisplay.classList.add('visible');
        }
        function hideCategoryTitle() { /* ... (no changes) ... */
            categoryTitleDisplay.classList.remove('visible');
            setTimeout(() => {
                 if (!categoryTitleDisplay.classList.contains('visible')) {
                    categoryTitleDisplay.textContent = '';
                 }
             }, 400);
        }
        function handleMegamenuToggle(event, isPageLoad = false) { /* ... (no changes) ... */
            const trigger = event.currentTarget || event;
            if (event.stopPropagation) { event.stopPropagation(); }
            const area = trigger.dataset.area;
            if (currentlyOpenTrigger === trigger && !isPageLoad) {
                megamenuContent.classList.add('hidden');
                trigger.classList.remove('active');
                currentlyOpenTrigger = null;
                hideSubcategoryDetails(false);
                hideGlossaryPanel();
                hideCategoryTitle();
                history.pushState("", document.title, window.location.pathname + window.location.search);
            } else if (currentlyOpenTrigger !== trigger || isPageLoad) {
                if (currentlyOpenTrigger && currentlyOpenTrigger !== trigger) {
                    currentlyOpenTrigger.classList.remove('active');
                     hideSubcategoryDetails(false); // Hide previous details when switching
                }
                populateMegamenuColumns(area);
                megamenuContent.classList.remove('hidden');
                trigger.classList.add('active');
                currentlyOpenTrigger = trigger;
                showCategoryTitle(trigger);
                 if (activeGlossaryTrigger) { hideGlossaryPanel(); }
                 if (!isPageLoad && !window.location.hash.includes('@')) {
                     window.location.hash = area;
                 }
            }
        }
        function handlePageLoad() { /* ... (no changes, ensures subcat details load correctly) ... */
              const hash = window.location.hash.substring(1);
             if (!hash) return;
             const parts = hash.split('@');
             const categoryArea = parts[0];
             const subcategoryId = parts.length > 1 ? parts[1] : null;
             if (categoryArea) {
                 const targetButton = buttonBar.querySelector(`.megamenu-trigger[data-area="${categoryArea}"]`);
                 if (targetButton) {
                     handleMegamenuToggle(targetButton, true); // Open main category
                     if (subcategoryId && currentlyOpenTrigger) {
                        // Use rAF and setTimeout to ensure columns are populated before finding toggle
                         requestAnimationFrame(() => {
                            setTimeout(() => {
                                const subcategoryToggle = megamenuColumnsContainer.querySelector(
                                    `.subcategory-toggle[data-area="${categoryArea}"][data-uniqueid="${subcategoryId}"]`
                                );
                                if (subcategoryToggle) {
                                    displaySubcategoryDetails(categoryArea, subcategoryId, false); // Display details without updating hash again
                                     // Update the button state correctly
                                     if (activeSubcategoryToggle) {
                                        activeSubcategoryToggle.classList.remove('active');
                                        activeSubcategoryToggle.textContent = 'Show More Info';
                                    }
                                    subcategoryToggle.classList.add('active');
                                    subcategoryToggle.textContent = 'Hide Info';
                                    activeSubcategoryToggle = subcategoryToggle;
                                     // Scroll to details after a short delay
                                     setTimeout(() => {
                                         megamenuDetailsArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                     }, 100);
                                } else { console.warn(`Subcategory toggle not found for hash: ${hash}`); }
                            }, 100); // Increased delay slightly
                         });
                     }
                 } else { console.warn(`Category button not found for hash: ${hash}`); }
             }
        }


        function displaySubcategoryDetails(area, uniqueId, updateHash = true) {
            const category = categoryData.find(cat => cat.area.toLowerCase() === area);
            const subcategory = category?.subcategories.find(sub => sub.uniqueId === uniqueId);

            if (!subcategory) {
                megamenuDetailsArea.innerHTML = '<p class="text-center text-red-500">Details not found.</p>';
                megamenuDetailsArea.classList.add('visible');
                return;
            }

            // Start building HTML for Context, Materials, Process
            let detailsHtml = `
                <h3 class="text-xl font-semibold text-gray-800 mb-4">${subcategory.title}</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div><h5 class="font-semibold text-md text-gray-700 mb-2 border-b pb-1">Context</h5><p class="text-sm text-gray-600">${subcategory.context || 'Details coming soon.'}</p></div>
                    <div><h5 class="font-semibold text-md text-gray-700 mb-2 border-b pb-1">Materials</h5><ul class="list-disc list-inside text-sm text-gray-600 space-y-1">${subcategory.materials ? subcategory.materials.map(m => `<li>${m}</li>`).join('') : '<li>Details coming soon.</li>'}</ul></div>
                    <div><h5 class="font-semibold text-md text-gray-700 mb-2 border-b pb-1">Process Steps</h5><ol class="list-decimal list-inside text-sm text-gray-600 space-y-1">${subcategory.processSteps ? subcategory.processSteps.map(s => `<li>${s}</li>`).join('') : '<li>Details coming soon.</li>'}</ol></div>
                </div>
            `;

            // --- Add Video Linker Grid ---
            if (subcategory.videos && subcategory.videos.length > 0) {
                detailsHtml += `
                    <h4 class="text-lg font-semibold text-gray-700 mb-3 pt-4 border-t">Related Videos</h4>
                    <div class="video-linker-container">`; // Container for the grid

                subcategory.videos.forEach(video => {
                    // Ensure video has been processed by flattenVideoData and has flat_index
                    if (video.flat_index === undefined || !video.youtubeId) {
                        console.warn("Skipping video - missing flat_index or youtubeId:", video.title);
                        return; // Skip if data is incomplete
                    }
                    const youtubeWatchUrl = `https://www.youtube.com/watch?v=${video.youtubeId}`;
                    const bgColor = video.color_tag; // Should have default from flatten
                    const iconClass = video.icon_tag_fa; // Should have default from flatten
                    const flatIndex = video.flat_index;
                    // Determine if we should use the fallback 'no-icon' style
                     const useNoIconFallback = !iconClass || iconClass === 'fas fa-video';

                    detailsHtml += `<a href="${youtubeWatchUrl}"
                                        target="_blank"
                                        class="video-linker ${useNoIconFallback ? 'no-icon' : ''}"
                                        style="background-color: ${bgColor};"
                                        data-flat-index="${flatIndex}"
                                        title="Open video: ${video.title}">`; // Tooltip for the link itself

                    if (!useNoIconFallback) {
                        detailsHtml += `<i class="${iconClass}"></i>`;
                    } else {
                        // Fallback text
                        detailsHtml += video.title.substring(0, 15) + (video.title.length > 15 ? '...' : '');
                    }
                    detailsHtml += `</a>`;
                });

                detailsHtml += `</div>`; // Close video-linker-container
            }
            // --- End Video Linker Grid ---

            // Add Back Button
            detailsHtml += `
                <div class="mt-8 text-right">
                    <button class="details-back-button">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" /></svg>
                        Back
                    </button>
                </div>`;

            // Inject into DOM and make visible
            megamenuDetailsArea.innerHTML = detailsHtml;
            megamenuColumnsContainer.classList.add('columns-hidden'); // Hide columns
            megamenuDetailsArea.classList.add('visible'); // Show details

            if (updateHash) {
                 window.location.hash = `${area}@${uniqueId}`;
            }
        }


        // --- Event Delegation Setup ---
        function setupEventListeners() {
            // For Subcategory Columns Area (Glossary, Show More)
            megamenuColumnsContainer.addEventListener('click', function(event) {
                const target = event.target;
                if (target.classList.contains('glossary-trigger')) {
                    handleGlossaryTriggerClick(event);
                }
                else if (target.classList.contains('subcategory-toggle')) {
                    handleSubcategoryToggle(event);
                }
            });

             // For Details Area (Back button)
            megamenuDetailsArea.addEventListener('click', function(event) {
                const target = event.target;
                 // Check if the click is on the back button or inside it
                if (target.closest('.details-back-button')) {
                    hideSubcategoryDetails(true);
                }
             });

            // --- Video Hover Listeners on Body ---
            document.body.addEventListener('mouseover', (event) => {
                const linker = event.target.closest('.video-linker');
                if (linker) {
                    const flatIndex = linker.getAttribute('data-flat-index');
                    if (flatIndex !== null) {
                        const video = allVideosFlat[parseInt(flatIndex, 10)];
                        if (video) {
                            showInfoPanel(video);
                        } else {
                             console.warn("Video data not found for index:", flatIndex);
                        }
                    }
                }
            });

            document.body.addEventListener('mouseout', (event) => {
                // Hide if the mouse leaves a linker and doesn't immediately enter another linker or the panel itself
                const leavingLinker = event.target.closest('.video-linker');
                const enteringElement = event.relatedTarget;

                if (leavingLinker && (!enteringElement || !enteringElement.closest('.video-linker, #video-info-panel'))) {
                     // Add a small delay to prevent flickering when moving quickly between linkers or to panel
                     setTimeout(() => {
                         // Double-check if the mouse is *still* outside linkers/panel after delay
                         const currentlyHovered = document.querySelector('.video-linker:hover, #video-info-panel:hover');
                         if (!currentlyHovered) {
                            hideInfoPanel();
                         }
                     }, 50);
                }
            });
            // Also hide if leaving the info panel itself
             videoInfoPanel.addEventListener('mouseleave', hideInfoPanel);
        }

        // --- Initial Setup ---
        console.log("Initializing...");
        flattenVideoData(categoryData); // Prepare flat video array **FIRST**
        generateHeaderButtons();
        setupEventListeners();
        handlePageLoad(); // Handles loading state from URL hash
        hideInfoPanel(); // Ensure hidden initially

    </script>







</body>
</html>
