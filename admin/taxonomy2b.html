<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Approüé•video Video Portal Managerüé•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
    /* Base styles */
    body {
        font-family: 'Poppins', sans-serif;
        background-color: #dbe5df;
        color: #333;
        transition: all 0.3s ease;
        background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h20v20H0V0zm10 17a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm20 0a7 7 0 1 0 0-14 7 7 0 0 0 0 14zM10 37a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm10-17h20v20H20V20zm10 17a7 7 0 1 0 0-14 7 7 0 0 0 0 14z' fill='%23e6912f' fill-opacity='0.11' fill-rule='evenodd'/%3E%3C/svg%3E");
    }

    /* Theme Colors */
    :root {
        --nile-blue: #8fb8cc;
        --desert-red: #c49178;
        --savanna-green: #96b089;
        
        --nile-blue-hover: #68c1e6;
        --desert-red-hover: #e6927a;
        --savanna-green-hover: #7fc261;
        
        --item-bg: #f9fafb;
        --body-text: #1a1a1e;
        --delete-btn: #c49178;
        --delete-btn-hover: #e6927a;
    }

    /* Profile Button and Dropdown Styles */
    .profile-dropdown {
        position: absolute;
        right: 0;
        top: 100%;
        background-color: white;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        width: 12rem;
        z-index: 50;
        transform-origin: top right;
        transition: all 0.2s ease;
    }

    /* Active State */
    .profile-dropdown.dropdown-active {
        opacity: 1;
        transform: scale(1);
        pointer-events: auto;
        visibility: visible;
    }

    /* Inactive State */
    .profile-dropdown.dropdown-inactive {
        opacity: 0;
        transform: scale(0.95);
        pointer-events: none;
        visibility: hidden;
    }

    /* Dropdown Items */
    .profile-dropdown .py-1 a {
        display: block;
        padding: 0.5rem 1rem;
        color: #374151;
        transition: all 0.2s ease;
    }

    .profile-dropdown .py-1 a:hover {
        background-color: #f3f4f6;
    }

    /* Dark Mode Styles */
    .dark-mode .profile-dropdown {
        background-color: #2d2d44;
        border: 1px solid #3f3f5f;
    }

    .dark-mode .profile-dropdown .py-1 a {
        color: #e5e7eb;
    }

    .dark-mode .profile-dropdown .py-1 a:hover {
        background-color: #3f3f5f;
    }

    .dark-mode #mainNav {
        background-color: #1a1a2e;
        color: #e5e7eb;
    }

    .dark-mode .nav-link {
        color: #e5e7eb;
    }

    .dark-mode #profileButton svg,
    .dark-mode #darkModeToggle svg {
        color: #e5e7eb;
    }

    /* Profile Button */
    #profileButton {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }

    #profileButton svg {
        width: 24px;
        height: 24px;
    }

    /* Navigation Container Dark Mode */
    .dark-mode nav.bg-white {
        background-color: #1a1a2e;
    }

    /* Dark Mode */
    body.dark-mode {
        background-color: #1a1a2e;
        color: #e1e1e1;
        background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h20v20H0V0zm10 17a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm20 0a7 7 0 1 0 0-14 7 7 0 0 0 0 14zM10 37a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm10-17h20v20H20V20zm10 17a7 7 0 1 0 0-14 7 7 0 0 0 0 14z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
        
        --item-bg: #2a2a3e;
        --body-text: #e1e1e1;
        --delete-btn: #b37a64;
        --delete-btn-hover: #e6927a;
    }

    /* Button Styles */
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        font-weight: 600;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .btn-blue {
        background-color: var(--nile-blue);
        color: white;
    }

    .btn-red {
        background-color: var(--desert-red);
        color: white;
    }

    .btn-green {
        background-color: var(--savanna-green);
        color: white;
    }

    .btn-blue:hover, .btn-red:hover, .btn-green:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .btn-blue:hover { background-color: var(--nile-blue-hover); }
    .btn-red:hover { background-color: var(--desert-red-hover); }
    .btn-green:hover { background-color: var(--savanna-green-hover); }

    /* Navigation Styles */
    .nav-container {
        background-color: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(8px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .dark-mode .nav-container {
        background-color: rgba(45, 45, 68, 0.9);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Category and Subcategory Styles */
    .category-item {
        background: white;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        animation: slideIn 0.3s ease-out;
        transition: all 0.3s ease;
    }

    .dark-mode .category-item {
        background-color: #2d2d44;
        box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        color: #e1e1e1;
    }

    .category-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .subcategory-item {
        background: #f3f4f6;
        padding: 0.75rem 1rem;
        border-radius: 6px;
        margin-bottom: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .dark-mode .subcategory-item {
        background-color: #3a3a54;
    }

    /* Tag Styles */
    .tag-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
        padding: 1rem 0;
    }

    .tag-item {
        background: white;
        padding: 1rem;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        transition: all 0.3s ease;
    }

    .dark-mode .tag-item {
        background-color: #2d2d44;
    }

    .tag-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    /* Animations */
    @keyframes slideIn {
        from { transform: translateY(-10px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Loading State */
    .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        color: #666;
    }

    .loading::after {
        content: '';
        width: 1.5rem;
        height: 1.5rem;
        border: 2px solid #3498db;
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 1s linear infinite;
        margin-left: 0.5rem;
    }

    /* Error State */
    .error {
        background: #fee;
        color: #e74c3c;
        padding: 1rem;
        border-radius: 4px;
        margin-bottom: 1rem;
    }

    /* Custom Scrollbar */
    .subcategories {
        max-height: 250px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: #9CA3AF transparent;
    }

    .subcategories::-webkit-scrollbar {
        width: 6px;
    }

    .subcategories::-webkit-scrollbar-track {
        background: transparent;
    }

    .subcategories::-webkit-scrollbar-thumb {
        background-color: #9CA3AF;
        border-radius: 3px;
    }

    /* Inline Editing Styles */
    .inline-edit-field {
        border: 2px solid var(--savanna-green);
        border-radius: 4px;
        padding: 0.5rem;
        font-size: inherit;
        font-weight: inherit;
        width: 100%;
        max-width: 300px;
        background-color: white;
        transition: all 0.2s ease;
    }

    .dark-mode .inline-edit-field {
        background-color: #1f1f35;
        border-color: var(--savanna-green);
        color: #e1e1e1;
    }

    .new-item-input {
        border: 2px solid var(--savanna-green);
        border-radius: 4px;
        padding: 0.5rem;
        font-size: inherit;
        background-color: white;
        width: 100%;
        max-width: 300px;
        transition: all 0.2s ease;
    }

    .dark-mode .new-item-input {
        background-color: #1f1f35;
        border-color: var(--savanna-green);
        color: #e1e1e1;
    }

    .category-name, .subcategory-name {
        cursor: pointer;
        padding: 0.25rem;
        border-radius: 4px;
        transition: background-color 0.2s ease;
    }

    .category-name:hover, .subcategory-name:hover {
        background-color: rgba(150, 176, 137, 0.1);
    }

    .category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
    }

    .subcategory-item {
        position: relative;
        border-radius: 8px;
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .subcategory-item:hover {
        background-color: rgba(150, 176, 137, 0.1);
    }

    .subcategory-controls {
        opacity: 0.3;
        transition: opacity 0.2s ease;
    }

    .subcategory-item:hover .subcategory-controls {
        opacity: 1;
    }

    .error-toast {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        background-color: #e74c3c;
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 4px;
        z-index: 1000;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        animation: fadeIn 0.3s, fadeOut 0.3s 2.7s;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOut {
        from { opacity: 1; transform: translateY(0); }
        to { opacity: 0; transform: translateY(20px); }
    }

    /* New Category and Subcategory Animation */
    .new-category, .new-subcategory {
        animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Dark Mode Adjustments */
    .dark-mode .category-name:hover, 
    .dark-mode .subcategory-name:hover,
    .dark-mode .subcategory-item:hover {
        background-color: rgba(150, 176, 137, 0.2);
    }

    /* Make the subcategory and category items look more clickable */
    .category-name::after, 
    .subcategory-name::after {
        content: '‚úèÔ∏è';
        font-size: 0.75em;
        opacity: 0;
        margin-left: 6px;
        transition: opacity 0.2s ease;
    }

    .category-name:hover::after, 
    .subcategory-name:hover::after {
        opacity: 1;
    }

/* Firefox-specific enhancements for inline editing */
.category-name, .subcategory-name {
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 4px;
    transition: background-color 0.2s ease;
    position: relative;
    user-select: none; /* Prevents text selection issues in Firefox */
}

.category-name:hover, .subcategory-name:hover {
    background-color: rgba(150, 176, 137, 0.2);
    outline: 2px solid rgba(150, 176, 137, 0.3);
}

/* Make editable elements more obvious */
.category-name::before, 
.subcategory-name::before {
    content: '‚úèÔ∏è';
    position: absolute;
    right: -25px;
    opacity: 0;
    transition: opacity 0.2s ease, transform 0.2s ease;
    transform: translateX(-10px);
}

.category-name:hover::before, 
.subcategory-name:hover::before {
    opacity: 1;
    transform: translateX(0);
}

/* Improved styling for the inline edit field */
.inline-edit-field {
    border: 2px solid var(--savanna-green);
    border-radius: 4px;
    padding: 0.5rem;
    font-size: inherit;
    font-weight: inherit;
    width: 100%;
    min-width: 200px; /* Ensure minimum width for usability */
    max-width: 100%;
    background-color: white;
    transition: all 0.2s ease;
    box-shadow: 0 0 0 3px rgba(150, 176, 137, 0.3);
    z-index: 5;
    position: relative;
}

.dark-mode .inline-edit-field {
    background-color: #1f1f35;
    border-color: var(--savanna-green);
    color: #e1e1e1;
}

/* Ensure inputs are properly sized and clickable */
.new-item-input {
    border: 2px solid var(--savanna-green);
    border-radius: 4px;
    padding: 0.5rem;
    font-size: inherit;
    background-color: white;
    width: 100%;
    min-width: 200px;
    max-width: 100%;
    transition: all 0.2s ease;
    box-shadow: 0 0 0 3px rgba(150, 176, 137, 0.3);
}

.dark-mode .new-item-input {
    background-color: #1f1f35;
    border-color: var(--savanna-green);
    color: #e1e1e1;
}

/* Visual feedback for keyboard focus */
.category-name:focus,
.subcategory-name:focus {
    outline: 2px solid var(--savanna-green);
    background-color: rgba(150, 176, 137, 0.2);
}

/* Add a subtle pointer cursor for all interactive elements */
.category-name, 
.subcategory-name,
.btn,
.delete-subcategory-btn {
    cursor: pointer;
}

/* Fix for Firefox event bubbling */
.subcategory-item {
    position: relative;
    pointer-events: auto;
}

.subcategory-name {
    pointer-events: auto;
    position: relative;
    z-index: 2;
}

/* Animation for the edit pencil icon */
@keyframes wiggle {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(10deg); }
    75% { transform: rotate(-10deg); }
    100% { transform: rotate(0deg); }
}
.category-name:hover::before,
.subcategory-name:hover::before {
    animation: wiggle 0.5s ease;
}   
/* Empty state styling */
.empty-state {
    padding: 2rem;
    text-align: center;
    color: #6b7280;
    background-color: rgba(255, 255, 255, 0.5);
    border-radius: 8px;
    margin: 1rem 0;
}
.dark-mode .empty-state {
    background-color: rgba(45, 45, 68, 0.5);
    color: #9ca3af;
}
</style>
</head>
<body>

<!-- Top Banner -->
<div class="bg-gradient-to-r from-green-600 to-blue-600 text-white py-2 px-4 text-center text-sm banner-message">
    <!-- Message will be inserted here by JavaScript -->
</div>

<!-- Main Header -->
<header class="shadow-lg">
    <div class="container mx-auto">
        <nav class="shadow-lg rounded-lg mb-8 transition-colors duration-300" id="mainNav">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <!-- Logo Section -->
                    <div class="flex items-center space-x-4">
                        <a href="index.html" class="flex items-center space-x-3 group">
                            <svg class="h-10 w-10 text-green-500 transform transition-all duration-300 group-hover:scale-110" 
                                viewBox="0 0 24 24" 
                                fill="none" 
                                stroke="currentColor" 
                                stroke-width="1.5"
                                id="logoIcon">
                                <circle class="tool-circle" cx="12" cy="12" r="10" stroke-dasharray="4 4"/>
                                <path class="tool-wrench" d="M3 21h4l9-9"/>
                                <path class="tool-screwdriver" d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                                <circle class="tool-gear" cx="12" cy="12" r="3"/>
                                <path class="tool-arrows" d="M8 12h8m-4-4v8" stroke-linecap="round"/>
                            </svg>
                            <span class="text-xl font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">
                                ApproAdmin
                            </span>
                        </a>
                    </div>

                    <!-- Navigation Items -->
                    <div class="flex items-center space-x-6">
                        <!-- Website Link -->
                        <a href="/" 
                            class="nav-link group flex items-center space-x-2 text-gray-600 hover:text-green-500 transition-all px-3 py-2 rounded-lg hover:bg-gray-50">
                            <span class="hidden md:inline">                     
                                <svg class="w-6 h-6 transform transition-all duration-300 text-gray-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle class="hover-spin" cx="12" cy="12" r="10"></circle>
                                    <path d="M2 12h20"></path>
                                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                                </svg>
                            </span>
                        </a>

                        <a href="new.html" 
                            class="nav-link group flex items-center space-x-2 text-gray-600 hover:text-green-500 transition-all px-3 py-2 rounded-lg hover:bg-gray-50">
                            <span class="hidden md:inline">                  
                                <svg class="w-6 h-6 transform transition-all duration-300 text-gray-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 8v8"></path>
                                    <path d="M8 12h8"></path>
                                </svg>
                            </span>
                        </a>

                        <!-- Dark Mode Toggle -->
                        <button id="darkModeToggle" 
                                class="p-2 rounded-lg transition-all duration-300 space-x-2 hover:text-green-500 transition-all px-3 py-2 rounded-lg hover:bg-gray-50 ">
                            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path class="dark-toggle" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                            </svg>
                        </button>

                        <!-- Profile Button -->
                        <div class="relative">
                            <button id="profileButton" 
                                class="icon-button p-2 rounded-lg transition-colors duration-300 space-x-2 text-gray-800 dark:text-gray-900 hover:text-green-500 transition-all px-3 hover:bg-gray-50">
                                <svg class="w-[39px] h-[39px]" stroke="currentColor" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 4h12M6 4v16M6 4H5m13 0v16m0-16h1m-1 16H6m12 0h1M6 20H5M9 7h1v1H9V7Zm5 0h1v1h-1V7Zm-5 4h1v1H9v-1Zm5 0h1v1h-1v-1Zm-3 4h2a1 1 0 0 1 1 1v4h-4v-4a1 1 0 0 1 1-1Z"/>
                                </svg>
                            </button>
                            <div id="profileDropdown"
                                class="profile-dropdown dropdown-inactive absolute right-0 mt-2 w-48 rounded-md shadow-lg ring-1 ring-black ring-opacity-5">
                                <div class="py-1">
                                    <a href="/videos.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Videos</a>
                                    <a href="new.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Add a Critical Skills Video</a>
                                    <a href="new_votech.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Add a Vo-tech Skills Video</a>
                                    <a href="pending.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Pending</a>
                                    <a href="taxonomy.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Taxonomy</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">----------</a>
                                    <a href="dashboard2.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Dashboard</a>
                                    <a href="community-and-learning-milestones.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Community and learning Milestones</a>
                                    <a href="/modules" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Learning Modules</a>
                                    <a href="calendar3.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Calendar</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sign out</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </div>
</header>

<!-- Content Area -->
<main class="container mx-auto px-4 py-8 max-w-5xl">
    <!-- Welcome Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg mb-8 p-6 border-l-4 border-green-500">
        <h1 class="text-3xl font-bold mb-2">Taxonomy Management</h1>
        <p class="text-gray-600 dark:text-gray-300">Organize your content with categories and subcategories. Click on any name to edit.</p>
    </div>

    <!-- Categories Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg mb-8 p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Categories & Subcategories</h2>
            <button class="btn btn-green" id="add-category-btn">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Add Category
            </button>
        </div>
        <div id="categories-container" class="categories-wrapper">
            <!-- Dynamic content will be rendered here -->
            <div class="loading">Loading categories...</div>
        </div>
    </div>

    <!-- Tags Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg mb-8 p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Tag Management</h2>
            <button id="add-tag-btn" class="btn btn-green">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Add Tag
            </button>
        </div>
        <div id="tag-cloud" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Tags will be rendered here -->
            <div class="empty-state">
                <svg class="w-12 h-12 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                </svg>
                <p>No tags yet. Click "Add Tag" to create your first tag.</p>
            </div>
        </div>
    </div>
</main>

<!-- JavaScript Section -->
<script type="module">
  <script type="module">
    import { createClient } from 'https:// New method to add explicit click handlers after rendering
        addExplicitClickHandlers() {
            // Add click handlers for category names
            const categoryNames = this.containerEl.querySelectorAll('.category-name');
            categoryNames.forEach(element => {
                element.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const categoryId = element.closest('.category-item').dataset.categoryId;
                    this.startEditing(element, 'category', categoryId);
                }
    }

    // Tag Management class (stub for future implementation)
    class TagManager {
        constructor(store) {
            this.store = store;
            this.containerEl = document.getElementById('tag-cloud');
            this.bindEvents();
        }

        bindEvents() {
            document.getElementById('add-tag-btn').addEventListener('click', () => {
                alert('Tag management will be implemented in a future update. Stay tuned!');
            });
        }
    }

    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const store = new BlueprintStore();
            window.categoryManager = new CategoryManager(store);
            window.tagManager = new TagManager(store);
            await store.loadInitialData();
        } catch (error) {
            console.error('Error initializing app:', error);
        }
    });
</script>);
                
                // Add keyboard handling for accessibility
                element.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        e.stopPropagation();
                        const categoryId = element.closest('.category-item').dataset.categoryId;
                        this.startEditing(element, 'category', categoryId);
                    }
                });
            });
            
            // Add click handlers for subcategory names
            const subcategoryNames = this.containerEl.querySelectorAll('.subcategory-name');
            subcategoryNames.forEach(element => {
                element.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const subcategoryItem = element.closest('.subcategory-item');
                    const categoryItem = element.closest('.category-item');
                    const subcategoryId = subcategoryItem.dataset.subcategoryId;
                    const categoryId = categoryItem.dataset.categoryId;
                    this.startEditing(element, 'subcategory', subcategoryId, categoryId);
                });
                
                // Add keyboard handling for accessibility
                element.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        e.stopPropagation();
                        const subcategoryItem = element.closest('.subcategory-item');
                        const categoryItem = element.closest('.category-item');
                        const subcategoryId = subcategoryItem.dataset.subcategoryId;
                        const categoryId = categoryItem.dataset.categoryId;
                        this.startEditing(element, 'subcategory', subcategoryId, categoryId);
                    }
                });
            });
        }cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabaseUrl = 'https://vlvbodwrtblttvwnxkjx.supabase.co';
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZsdmJvZHdydGJsdHR2d254a2p4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODY3NDk2NzIsImV4cCI6MjAwMjMyNTY3Mn0.TRT1HeX85vP1zDxnU7qBz5GqNPgYZUj-BOdek4qmtEg';
    const supabase = createClient(supabaseUrl, supabaseAnonKey);

    // Banner messages
    const bannerMessages = [
        "üé• Sharing knowledge that changes lives - One video at a time",
        "üå± Building resilience through appropriate technology",
        "üíß Clean water, safe shelter, better lives",
        "üåü Empowering communities with sustainable solutions",
        "ü§ù Technology that serves humanity",
        "üèóÔ∏è Building bridges to a sustainable future",
        "üí™ Local solutions, global impact",
        "üåç Every community deserves access to vital knowledge"
    ];

    // Add this to your DOMContentLoaded event listener
    document.addEventListener('DOMContentLoaded', () => {
        const banner = document.querySelector('.bg-gradient-to-r.from-green-600');
        let currentMessageIndex = 0;

        function updateBannerMessage() {
            banner.textContent = bannerMessages[currentMessageIndex];
            currentMessageIndex = (currentMessageIndex + 1) % bannerMessages.length;
        }

        // Initial message
        updateBannerMessage();

        // Rotate message every 5 seconds
        setInterval(updateBannerMessage, 5000);

        // Profile dropdown functionality
        const profileButton = document.getElementById('profileButton');
        const profileDropdown = document.getElementById('profileDropdown');
        let isDropdownOpen = false;

        profileButton.addEventListener('click', (e) => {
            e.stopPropagation();
            isDropdownOpen = !isDropdownOpen;
            if (isDropdownOpen) {
                profileDropdown.classList.remove('dropdown-inactive');
                profileDropdown.classList.add('dropdown-active');
            } else {
                profileDropdown.classList.remove('dropdown-active');
                profileDropdown.classList.add('dropdown-inactive');
            }
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!profileButton.contains(e.target) && isDropdownOpen) {
                profileDropdown.classList.remove('dropdown-active');
                profileDropdown.classList.add('dropdown-inactive');
                isDropdownOpen = false;
            }
        });

        // Dark mode toggle functionality
        const darkModeToggle = document.getElementById('darkModeToggle');
        
        // Check for saved dark mode preference
        const savedDarkMode = localStorage.getItem('darkMode') === 'true';
        if (savedDarkMode) {
            document.body.classList.add('dark-mode');
        }

        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            // Save preference
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        });
    });

    class EventEmitter {
        constructor() {
            this.events = {};
        }

        on(event, callback) {
            if (!this.events[event]) {
                this.events[event] = [];
            }
            this.events[event].push(callback);
        }

        emit(event, data) {
            if (this.events[event]) {
                this.events[event].forEach(callback => callback(data));
            }
        }
    }

    class BlueprintStore extends EventEmitter {
        constructor() {
            super();
            this.supabase = supabase;
            this.categories = [];
            this.isLoading = false;
            this.error = null;
        }

        async loadInitialData() {
            try {
                this.isLoading = true;
                this.emit('loading', true);

                const { data: categories, error } = await this.supabase
                    .from('categories')
                    .select('*, subcategories(*)');

                if (error) throw error;
                this.categories = categories || [];
                this.emit('dataLoaded', { categories: this.categories });
            } catch (error) {
                console.error('Error loading data:', error);
                this.error = error.message;
                this.emit('error', error.message);
            } finally {
                this.isLoading = false;
                this.emit('loading', false);
            }
        }

        async addCategory(categoryData) {
            try {
                // Generate a slug from the category name
                if (!categoryData.name) {
                    throw new Error('Category name is required');
                }
                const slug = categoryData.name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');

                // Prepare category data for insertion without the subcategories array
                const newCategoryData = {
                    ...categoryData,
                    slug: slug
                };

                // Insert the new category into Supabase
                const { data, error } = await this.supabase
                    .from('categories')
                    .insert([newCategoryData])
                    .select();

                if (error) throw error;

                // Update local state with the new category and initialize subcategories
                const newCategory = {
                    ...data[0],
                    subcategories: [] // Add an empty subcategories array to maintain the local structure
                };

                this.categories.push(newCategory);
                this.emit('dataLoaded', { categories: this.categories });
            } catch (error) {
                console.error('Error adding category:', error);
                this.emit('error', error.message);
            }
        }

        async updateCategory(categoryId, categoryData) {
            try {
                // Generate a slug from the category name if it's provided
                let updatedData = { ...categoryData };
                if (categoryData.name) {
                    updatedData.slug = categoryData.name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
                }

                const { data, error } = await this.supabase
                    .from('categories')
                    .update(updatedData)
                    .eq('id', categoryId)
                    .select();

                if (error) throw error;

                // Update local state
                const categoryIndex = this.categories.findIndex(cat => cat.id === categoryId);
                if (categoryIndex !== -1) {
                    // Update only the provided fields, keep the rest
                    this.categories[categoryIndex] = {
                        ...this.categories[categoryIndex],
                        ...data[0]
                    };
                }

                this.emit('dataLoaded', { categories: this.categories });
            } catch (error) {
                console.error('Error updating category:', error);
                this.emit('error', error.message);
            }
        }

        async addSubcategory(categoryId, subcategoryData) {
            try {
                // Generate a slug for the subcategory name
                const slug = subcategoryData.name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');

                const { data, error } = await this.supabase
                    .from('subcategories')
                    .insert([{ ...subcategoryData, category_id: categoryId, slug }])
                    .select();

                if (error) throw error;

                const category = this.categories.find(cat => cat.id === categoryId);

                // Initialize subcategories array if it is undefined
                if (!category.subcategories) {
                    category.subcategories = [];
                }

                // Push the new subcategory to the category's subcategories array
                category.subcategories.push(data[0]);

                this.emit('dataLoaded', { categories: this.categories });
            } catch (error) {
                console.error('Error adding subcategory:', error);
                this.emit('error', error.message);
            }
        }

        async deleteSubcategory(subcategoryId, categoryId) {
            try {
                const { error } = await this.supabase
                    .from('subcategories')
                    .delete()
                    .eq('id', subcategoryId);

                if (error) throw error;
                const category = this.categories.find(cat => cat.id === categoryId);
                if (category) {
                    category.subcategories = category.subcategories.filter(sub => sub.id !== subcategoryId);
                }
                this.emit('dataLoaded', { categories: this.categories });
            } catch (error) {
                console.error('Error deleting subcategory:', error);
                this.emit('error', error.message);
            }
        }

        async deleteCategory(categoryId) {
            try {
                const { error } = await this.supabase
                    .from('categories')
                    .delete()
                    .eq('id', categoryId);

                if (error) throw error;

                this.categories = this.categories.filter(cat => cat.id !== categoryId);
                this.emit('dataLoaded', { categories: this.categories });
            } catch (error) {
                console.error('Error deleting category:', error);
                this.emit('error', error.message);
            }
        }

        async updateSubcategory(subcategoryId, categoryId, subcategoryData) {
            try {
                const { data, error } = await this.supabase
                    .from('subcategories')
                    .update({ ...subcategoryData, slug: subcategoryData.name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '') })
                    .eq('id', subcategoryId)
                    .select();

                if (error) throw error;
                const category = this.categories.find(cat => cat.id === categoryId);
                if (category) {
                    const subcategoryIndex = category.subcategories.findIndex(sub => sub.id === subcategoryId);
                    if (subcategoryIndex > -1) {
                        category.subcategories[subcategoryIndex] = data[0];
                    }
                }
                this.emit('dataLoaded', { categories: this.categories });
            } catch (error) {
                console.error('Error updating subcategory:', error);
                this.emit('error', error.message);
            }
        }
    }

    class CategoryManager {
        constructor(store) {
            this.store = store;
            this.containerEl = document.getElementById('categories-container');
            this.bindEvents();
            this.bindStoreEvents();
            this.editingState = {
                isEditing: false,
                elementId: null,
                type: null, // 'category' or 'subcategory'
                originalValue: null
            };
        }

        bindEvents() {
            document.getElementById('add-category-btn').addEventListener('click', () => {
                this.createNewCategory();
            });

            // Handle clicks on the container for event delegation
            this.containerEl.addEventListener('click', (e) => {
                const target = e.target;
                
                // More explicit handling of click targets for Firefox
                // Handle category name click for editing
                if (target.classList.contains('category-name')) {
                    e.preventDefault();
                    e.stopPropagation();
                    const categoryId = target.closest('.category-item').dataset.categoryId;
                    this.startEditing(target, 'category', categoryId);
                    return;
                }
                
                // Handle subcategory name click for editing
                if (target.classList.contains('subcategory-name')) {
                    e.preventDefault();
                    e.stopPropagation();
                    const subcategoryItem = target.closest('.subcategory-item');
                    const categoryItem = target.closest('.category-item');
                    const subcategoryId = subcategoryItem.dataset.subcategoryId;
                    const categoryId = categoryItem.dataset.categoryId;
                    this.startEditing(target, 'subcategory', subcategoryId, categoryId);
                    return;
                }
                
                // Handle add subcategory button
                if (target.classList.contains('add-subcategory-btn') || target.closest('.add-subcategory-btn')) {
                    const categoryId = target.closest('.category-item').dataset.categoryId;
                    this.createNewSubcategory(categoryId);
                    return;
                }
                
                // Handle delete category button
                if (target.classList.contains('delete-category-btn') || target.closest('.delete-category-btn')) {
                    const categoryId = target.closest('.category-item').dataset.categoryId;
                    this.deleteCategory(categoryId);
                    return;
                }
                
                // Handle delete subcategory button
                if (target.classList.contains('delete-subcategory-btn') || target.closest('.delete-subcategory-btn')) {
                    const subcategoryItem = target.closest('.subcategory-item');
                    const categoryItem = target.closest('.category-item');
                    const subcategoryId = subcategoryItem.dataset.subcategoryId;
                    const categoryId = categoryItem.dataset.categoryId;
                    this.deleteSubcategory(subcategoryId, categoryId);
                    return;
                }
            });

            // Handle keydown events (for saving/canceling edits)
            document.addEventListener('keydown', (e) => {
                if (!this.editingState.isEditing) return;
                
                if (e.key === 'Enter') {
                    this.saveEdit();
                } else if (e.key === 'Escape') {
                    this.cancelEdit();
                }
            });

            // Handle clicks outside editing field to save
            document.addEventListener('click', (e) => {
                if (!this.editingState.isEditing) return;
                
                const editField = document.getElementById('inline-edit-field');
                if (editField && !editField.contains(e.target)) {
                    this.saveEdit();
                }
            });
        }

        bindStoreEvents() {
            this.store.on('loading', (isLoading) => {
                if (isLoading) {
                    this.containerEl.innerHTML = '<div class="loading">Loading categories...</div>';
                } else {
                    this.render();
                }
            });

            this.store.on('dataLoaded', () => {
                this.render();
            });

            this.store.on('error', (errorMessage) => {
                const errorToast = document.createElement('div');
                errorToast.className = 'error-toast';
                errorToast.textContent = errorMessage;
                document.body.appendChild(errorToast);
                
                setTimeout(() => {
                    errorToast.remove();
                }, 3000);
            });
        }

        async deleteCategory(categoryId) {
            if (confirm('Are you sure you want to delete this category?')) {
                try {
                    await this.store.deleteCategory(categoryId);
                } catch (error) {
                    alert('Error deleting category: ' + error.message);
                }
            }
        }

        async deleteSubcategory(subcategoryId, categoryId) {
            if (confirm('Are you sure you want to delete this subcategory?')) {
                try {
                    await this.store.deleteSubcategory(subcategoryId, categoryId);
                } catch (error) {
                    alert('Error deleting subcategory: ' + error.message);
                }
            }
        }

        createNewCategory() {
            // Create a new blank category item at the top of the list
            const tempId = 'new-category-' + Date.now();
            const newCategoryHTML = `
                <div class="category-item new-category" data-category-id="${tempId}">
                    <div class="category-header">
                        <div>
                            <input type="text" 
                                id="new-category-input" 
                                class="new-item-input" 
                                placeholder="Enter category name" 
                                autofocus>
                        </div>
                        <div class="category-controls">
                            <button class="btn btn-green save-new-category-btn">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Save
                            </button>
                            <button class="btn btn-red cancel-new-category-btn">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            this.containerEl.insertAdjacentHTML('afterbegin', newCategoryHTML);
            
            // Add event listeners for save and cancel
            const newCategoryItem = this.containerEl.querySelector('.new-category');
            const inputField = newCategoryItem.querySelector('#new-category-input');
            
            newCategoryItem.querySelector('.save-new-category-btn').addEventListener('click', async () => {
                const name = inputField.value.trim();
                if (name) {
                    try {
                        await this.store.addCategory({ name });
                        newCategoryItem.remove();
                    } catch (error) {
                        alert('Error adding category: ' + error.message);
                    }
                } else {
                    alert('Category name cannot be empty');
                }
            });
            
            newCategoryItem.querySelector('.cancel-new-category-btn').addEventListener('click', () => {
                newCategoryItem.remove();
            });
            
            // Focus on the input field
            inputField.focus();
            
            // Handle enter key press
            inputField.addEventListener('keydown', async (e) => {
                if (e.key === 'Enter') {
                    const name = inputField.value.trim();
                    if (name) {
                        try {
                            await this.store.addCategory({ name });
                            newCategoryItem.remove();
                        } catch (error) {
                            alert('Error adding category: ' + error.message);
                        }
                    } else {
                        alert('Category name cannot be empty');
                    }
                } else if (e.key === 'Escape') {
                    newCategoryItem.remove();
                }
            });
        }

        createNewSubcategory(categoryId) {
            const categoryItem = this.containerEl.querySelector(`.category-item[data-category-id="${categoryId}"]`);
            const subcategoriesContainer = categoryItem.querySelector('.subcategories');
            
            // Create a new blank subcategory item
            const tempId = 'new-subcategory-' + Date.now();
            const newSubcategoryHTML = `
                <div class="subcategory-item new-subcategory" data-subcategory-id="${tempId}">
                    <input type="text" 
                        id="new-subcategory-input" 
                        class="new-item-input" 
                        placeholder="Enter subcategory name" 
                        autofocus>
                    <div class="subcategory-controls">
                        <button class="btn btn-green save-new-subcategory-btn">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            Save
                        </button>
                        <button class="btn btn-red cancel-new-subcategory-btn">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            subcategoriesContainer.insertAdjacentHTML('afterbegin', newSubcategoryHTML);
            
            // Add event listeners for save and cancel
            const newSubcategoryItem = subcategoriesContainer.querySelector('.new-subcategory');
            const inputField = newSubcategoryItem.querySelector('#new-subcategory-input');
            
            newSubcategoryItem.querySelector('.save-new-subcategory-btn').addEventListener('click', async () => {
                const name = inputField.value.trim();
                if (name) {
                    try {
                        await this.store.addSubcategory(categoryId, { name });
                        newSubcategoryItem.remove();
                    } catch (error) {
                        alert('Error adding subcategory: ' + error.message);
                    }
                } else {
                    alert('Subcategory name cannot be empty');
                }
            });
            
            newSubcategoryItem.querySelector('.cancel-new-subcategory-btn').addEventListener('click', () => {
                newSubcategoryItem.remove();
            });
            
            // Focus on the input field
            inputField.focus();
            
            // Handle enter key press
            inputField.addEventListener('keydown', async (e) => {
                if (e.key === 'Enter') {
                    const name = inputField.value.trim();
                    if (name) {
                        try {
                            await this.store.addSubcategory(categoryId, { name });
                            newSubcategoryItem.remove();
                        } catch (error) {
                            alert('Error adding subcategory: ' + error.message);
                        }
                    } else {
                        alert('Subcategory name cannot be empty');
                    }
                } else if (e.key === 'Escape') {
                    newSubcategoryItem.remove();
                }
            });
        }

        // Updated startEditing method to ensure it works in Firefox
        startEditing(element, type, id, categoryId = null) {
            // If already editing something else, save that first
            if (this.editingState.isEditing) {
                this.saveEdit();
            }
            
            // Save the original value and set editing state
            const originalValue = element.textContent.trim();
            this.editingState = {
                isEditing: true,
                element: element,
                type: type,
                id: id,
                categoryId: categoryId,
                originalValue: originalValue
            };
            
            // Create the input field before clearing the element
            const inputField = document.createElement('input');
            inputField.type = 'text';
            inputField.value = originalValue;
            inputField.id = 'inline-edit-field';
            inputField.className = 'inline-edit-field';
            inputField.setAttribute('data-original-value', originalValue);
            
            // Clear the element and append the input field
            element.textContent = '';
            element.appendChild(inputField);
            
            // Force a reflow to ensure Firefox renders the input
            void element.offsetWidth;
            
            // Focus and select with a slight delay for Firefox
            setTimeout(() => {
                inputField.focus();
                inputField.select();
            }, 10);
        }

        async saveEdit() {
            if (!this.editingState.isEditing) return;
            
            const inputField = document.getElementById('inline-edit-field');
            if (!inputField) return;
            
            const newValue = inputField.value.trim();
            const originalValue = this.editingState.originalValue;
            
            // Only proceed if value has changed
            if (newValue && newValue !== originalValue) {
                try {
                    if (this.editingState.type === 'category') {
                        // Update category
                        await this.store.updateCategory(this.editingState.id, { name: newValue });
                    } else if (this.editingState.type === 'subcategory') {
                        // Update subcategory
                        await this.store.updateSubcategory(
                            this.editingState.id, 
                            this.editingState.categoryId, 
                            { name: newValue }
                        );
                    }
                } catch (error) {
                    alert(`Error updating ${this.editingState.type}: ${error.message}`);
                    // Restore original value
                    this.editingState.element.textContent = originalValue;
                }
            } else if (!newValue) {
                // If empty, restore original value
                this.editingState.element.textContent = originalValue;
            } else {
                // No change, just restore the text
                this.editingState.element.textContent = originalValue;
            }
            
            // Reset editing state
            this.editingState = {
                isEditing: false,
                element: null,
                type: null,
                id: null,
                categoryId: null,
                originalValue: null
            };
        }

        cancelEdit() {
            if (!this.editingState.isEditing) return;
            
            // Restore original content
            this.editingState.element.textContent = this.editingState.originalValue;
            
            // Reset editing state
            this.editingState = {
                isEditing: false,
                element: null,
                type: null,
                id: null,
                categoryId: null,
                originalValue: null
            };
        }

        render() {
            if (this.store.error) {
                this.containerEl.innerHTML = `<div class="error">${this.store.error}</div>`;
                return;
            }

            if (this.store.categories.length === 0) {
                this.containerEl.innerHTML = `
                    <div class="empty-state">
                        <svg class="w-12 h-12 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path>
                        </svg>
                        <p>No categories yet. Click "Add Category" to create your first category.</p>
                    </div>
                `;
                return;
            }

            this.containerEl.innerHTML = this.store.categories.map(category => `
                <div class="category-item" data-category-id="${category.id}">
                    <div class="category-header flex justify-between items-center p-3 border-b">
                        <div>
                            <h3 class="text-xl font-bold category-name" tabindex="0" role="button" aria-label="Edit category name">${category.name}</h3>
                            <span class="text-xs text-gray-500 dark:text-gray-400">(Click to edit)</span>
                        </div>
                        <div class="category-controls flex space-x-2">
                            <button class="btn btn-green add-subcategory-btn" aria-label="Add subcategory">
                                <svg class="w-5 h-5 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                                Add Subcategory
                            </button>
                            <button class="btn btn-red delete-category-btn" aria-label="Delete category">
                                <svg class="w-5 h-5 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                                Delete
                            </button>
                        </div>
                    </div>
                    <div class="subcategories mt-2 p-3">
                        ${category.subcategories && category.subcategories.length > 0 ? 
                            category.subcategories.map(subcategory => `
                                <div class="subcategory-item flex justify-between items-center p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md transition-colors" data-subcategory-id="${subcategory.id}">
                                    <p class="font-medium subcategory-name" tabindex="0" role="button" aria-label="Edit subcategory name">${subcategory.name}</p>
                                    <div class="subcategory-controls">
                                        <button class="text-red-500 hover:text-red-700 delete-subcategory-btn" aria-label="Delete subcategory">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            `).join('') : 
                            '<p class="text-gray-500 dark:text-gray-400 p-2">No subcategories yet.</p>'
                        }
                    </div>
                </div>
            `).join('');
            
            // Add explicit click handlers after rendering (for Firefox)
            this.addExplicitClickHandlers();
        }
        
        //
</script>
</body>
</html>
